<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Trabajo Final De Master</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="crisp-dm-couriers_files/libs/clipboard/clipboard.min.js"></script>
<script src="crisp-dm-couriers_files/libs/quarto-html/quarto.js"></script>
<script src="crisp-dm-couriers_files/libs/quarto-html/popper.min.js"></script>
<script src="crisp-dm-couriers_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="crisp-dm-couriers_files/libs/quarto-html/anchor.min.js"></script>
<link href="crisp-dm-couriers_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="crisp-dm-couriers_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="crisp-dm-couriers_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="crisp-dm-couriers_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="crisp-dm-couriers_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Trabajo Final De Master</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Master en Data Science For Business</strong></p>
<p>Estudiantes: - Maria Jesús Quirós - Jorge Luis Barquero Villagra</p>
<section id="crisp-dm" class="level1">
<h1>CRISP-DM</h1>
</section>
<section id="índice" class="level1">
<h1>Índice</h1>
<p>Pensar como hacer el índice</p>
<p>Para ejecutar el siguiente notebook se debe tener un ambiente de Python con las siguientes librerías instaladas.</p>
<p>Versión de Python 3.8.xx</p>
<ul>
<li>mysql-connector-python 8.4.0</li>
<li>plotly 5.9.0</li>
<li>mlxtend ???</li>
<li></li>
</ul>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install mysql-connector-python     </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install plotly                     </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install mlxtend            </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install networkx </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install fbprophet</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install openpyxl</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install nbformat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imports para ejecución del notebook</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os <span class="im">as</span> os</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlxtend.frequent_patterns <span class="im">import</span> association_rules</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlxtend.frequent_patterns <span class="im">import</span> apriori</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophet <span class="im">import</span> Prophet</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable global para administrar el directorio actual</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>parent_dir <span class="op">=</span> os.path.dirname(os.getcwd())</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (parent_dir)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Ubicación de base de datos</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>database_name <span class="op">=</span> <span class="st">'/data/database/tfm_couriers.db'</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Funciones reutilizables</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SalvarEnBD(table_name, data):</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(parent_dir <span class="op">+</span> database_name)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convierte el DataFrame a una tabla SQL</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    data.to_sql(table_name , conn, if_exists<span class="op">=</span><span class="st">'replace'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/jorgebarquero/GitRepos/couriersTFM/CouriersCR</code></pre>
</div>
</div>
</section>
<section id="business-understanding" class="level1">
<h1>1. Business Understanding</h1>
<p>Un courier es una empresa o servicio especializado en la entrega rápida y eficiente de paquetes, documentos y otros tipos de envíos. A diferencia de los servicios postales tradicionales, los couriers suelen ofrecer una mayor velocidad, seguridad y confiabilidad en la entrega de sus envíos. Suelen caracterizarse porque sus servicios incluyen:</p>
<ul>
<li>Rapidez: Algunas empresas couriers pueden hacer entregas en el mismo día, al día siguiente o en un plazo muy corto, dependiendo de la urgencia del envío.</li>
<li>Seguimiento: Los envíos por courier generalmente pueden ser rastreados en tiempo real, proporcionando información precisa sobre el estado y la ubicación del paquete.</li>
<li>Seguridad: Los couriers a menudo ofrecen un manejo más cuidadoso de los envíos, con seguros y opciones de firma al recibir el paquete.</li>
<li>Flexibilidad: Ofrecen una amplia gama de servicios, desde entregas locales y nacionales hasta envíos internacionales, adaptándose a las necesidades específicas de sus clientes.</li>
<li>Servicio al cliente: Proporcionan atención personalizada y soluciones específicas para problemas o necesidades de envío.</li>
</ul>
<p>Los couriers son utilizados tanto por particulares como por empresas que necesitan enviar documentos importantes, productos comprados en línea, muestras comerciales, y otros tipos de paquetes que requieren una entrega rápida y segura.</p>
<p>La empresa ExpediteX es una empresa dedicada a prestación de servicios logísticos de Courier y mensajería, que cuenta con 25 años de experiencia en el mercado. Sus servicios van desde la importación de productos en la modalidad de carga y paqueteo, distribución local y nacional a domicilio, hasta la asesoría para la importación y exportación, casillero internacional y asesoría de compras internacionales.</p>
<p>Por otro lado, SwiftShip cuenta con experiencia de 19 años en el manejo y traslado de paquetes y encomiendas, se caracterizan por trabajar directamente, sea, desde el recibimiento hasta la entrega de las mercancías es manejada por la empresa directamente (sin intermediarios).</p>
<p>Adicionalmente cuentan con 207 sucursales y/o puntos de recepción a nivel internacional en 50 países diferentes, entre ellos Estados Unidos, Canadá, Panamá, República Dominicana, Guatemala, Venezuela, Argentina, Brasil, Chile, Colombia, Ecuador, Perú, Uruguay, España, Italia, Portugal, Alemania y el resto de la Comunidad Europea.</p>
<p>Ambas empresas operan en un mercado muy competitivo, donde la eficiencia en la entrega, la cobertura geográfica y la calidad del servicio al cliente son factores clave para su éxito. Estas empresas ofrecen una variedad de servicios, que van desde la entrega de paquetes locales hasta el envío internacional, adaptándose a las necesidades de diferentes segmentos del mercado, como particulares y empresas.</p>
<p>La integración de tecnologías avanzadas, como el rastreo en tiempo real y la gestión automatizada de inventarios y compras juega un papel crucial en la optimización de los procesos logísticos, con lo que la incorporación de toma de la decisiones basadas en datos, tiene gran importancia en las empresas de courier, pues es crucial para optimizar sus operaciones, mejorar la satisfacción del cliente y aumentar la eficiencia en el manejo de envíos.</p>
<section id="objetivo-general" class="level2">
<h2 class="anchored" data-anchor-id="objetivo-general">Objetivo General</h2>
<p>Desarrollar mediante la metodología CRISP-DM un análisis de datos sobre los procesos de importación de las empresas SwiftShip y ExpediteX de courier en Costa Rica durante el período 2021-2023, para la optimización de sus operaciones y mejora de la toma de decisiones estratégicas. Utilizando técnicas avanzadas de análisis de datos y las herramientas disponibles, se espera obtener al menos cinco recomendaciones concretas y presentar los hallazgos en un informe detallado en el plazo de cuatro meses.</p>
</section>
<section id="objetivos-específicos" class="level2">
<h2 class="anchored" data-anchor-id="objetivos-específicos">Objetivos Específicos</h2>
<ul>
<li><p>Implementar un análisis de cesta (basket analysis) utilizando algoritmos de asociación para la identificación de los patrones más relevantes de compra y relaciones entre los productos adquiridos por los importadores que han utilizado los servicios de las empresas SwiftShip y ExpediteX de courier en Costa Rica. Utilizando los datos de transacciones de los últimos tres años, se espera la mejora en las estrategias de marketing y optimización del servicio. El análisis se lleva a cabo y los resultados se presentan en un informe detallado en un plazo de tres meses.</p></li>
<li><p>Realizar un análisis de tendencias de las mercancías importadas utilizando técnicas de análisis de series temporales, para la identificación de patrones significativos y cambios importantes en la demanda de diferentes tipos de mercancías a lo largo del tiempo. Esto permitirá la anticipación de las necesidades logísticas y ajustes de estrategias de importación para la mejora de la eficiencia operativa. Dicho análisis se completará en un plazo de seis meses.</p></li>
<li><p>Diseñar un conjunto de tres variables ingenieriles específicas para la implementación en las empresas SwiftShip y ExpediteX, para la optimización de los procesos de importación bajo la modalidad courier. Utilizando técnicas de análisis de datos y conocimientos de la industria, se espera la mejora de la eficiencia y efectividad de dichos procesos. Este diseño y la implementación de un plan piloto se completarán en un plazo de cinco meses.</p></li>
</ul>
</section>
</section>
<section id="data-understanding" class="level1">
<h1>2. Data Understanding</h1>
<p>La etapa de <strong>Entendimiento de los Datos</strong> es el segundo paso en el proceso CRISP-DM aplicado al análisis de las operaciones de importación de las empresas SwiftShip y ExpediteX en Costa Rica. El objetivo es comprender la complejidad y el alcance de los datos recopilados desde enero de 2021 hasta diciembre de 2023.</p>
<ul>
<li><p><strong>Recopilación de Datos</strong>: Se verifica que los datos recopilados, que abarcan desde detalles de la factura hasta el peso de los envíos y los impuestos aplicados, sean accesibles y estén completos. Se presta especial atención a la integridad de los datos relacionados con las fechas de importación, los valores CIF, y las descripciones de las mercancías para asegurar una base sólida para el análisis.</p></li>
<li><p><strong>Descripción de los Datos</strong>: Se realiza un examen detallado de los conjuntos de datos, destacando las columnas clave como ‘Año’, ‘DUA’, ‘Importador’, ‘Valor CIF US$’, y ‘Peso neto Kg.’, entre otros. Se utilizan estadísticas descriptivas para obtener una visión general de la cantidad de operaciones de importación, los rangos de valores, y las tendencias generales en los datos.</p></li>
<li><p><strong>Exploración de los Datos</strong>: Se busca comprender las relaciones entre diferentes variables, como el impacto del país de origen en el valor CIF, o la correlación entre el peso de los envíos y los costos de flete. Herramientas de visualización de datos y análisis exploratorio son empleadas para identificar patrones estacionales, tendencias en la demanda de mercancías, y posibles anomalías o outliers.</p></li>
<li><p><strong>Verificación de la Calidad de los Datos</strong>: Se evalúa la calidad de los datos identificando y abordando problemas como valores faltantes en campos críticos (e.g., ‘Valor CIF US$’), inconsistencias en la descripción de las mercancías, o duplicados en los registros de importación. Esta evaluación es fundamental para garantizar la precisión de los análisis de tendencias y de cesta de compras que se realizarán en etapas posteriores.</p></li>
</ul>
<p>Este entendimiento profundo de los datos de importación de courier en Costa Rica es esencial para avanzar hacia los objetivos específicos del proyecto, incluyendo la implementación de análisis de cesta para identificar patrones de compra, el análisis de tendencias de las mercancías importadas, y la optimización de los procesos de importación para SwiftShip y ExpediteX.</p>
<section id="definiciones" class="level2">
<h2 class="anchored" data-anchor-id="definiciones">Definiciones</h2>
<ul>
<li><p><strong>Aduana:</strong> Unidad técnico-administrativa encargada de las gestiones aduaneras y del control de las entradas, la permanencia y la salida de las mercancías objeto del comercio internacional (Art. 13 LGA).</p></li>
<li><p><strong>Agente aduanero:</strong> Profesional auxiliar de la función pública aduanera autorizado por la DGA para actuar, en su carácter de persona natural en la presentación habitual de servicios a terceros, en los trámites, los regímenes y las operaciones aduaneras. (Art. 33, LGA)</p></li>
<li><p><strong>Auxiliar de la Función Pública:</strong> Personas físicas o jurídicas, públicas o privadas, que participen habitualmente ante el Servicio Nacional de Aduanas (SNA), en nombre propio o de terceros. (Art. 28 LGA).</p></li>
<li><p><strong>Bultos:</strong> Unidad utilizada para contener mercancías. Puede consistir en cajas, sacas, fardos, cilindros y demás formas de presentación de las mercancías, según su naturaleza (Ministerio de Hacienda, 2021).</p></li>
<li><p><strong>Código Sistema Arancelario Centroamericano (SAC):</strong> El Arancel Centroamericano de Importación está constituido por el Sistema Arancelario Centroamericano (SAC) y los correspondientes Derechos Arancelarios a la Importación (DAI). El código numérico del SAC está representado por diez dígitos que identifican: los dos primeros, al capítulo; los dos siguientes, a la partida; el tercer par, a la subpartida; y los cuatro últimos, a los incisos arancelarios. La identificación de las mercancías se hará siempre con los diez dígitos de dicho código numérico. (Estrategia Aduanera, s.f.)</p></li>
<li><p><strong>Código Sistema Armonizado (SA):</strong> El Sistema Armonizado (SA) es un código de clasificación de mercancías creado por la Organización Mundial de Aduanas (OMA) y está compuesto por 6 dígitos con aceptación en todo el mundo. Sirve para llevar un control en las mercancías de exportación e importación en cuanto a los impuestos internos, monitoreo de bienes, origen y materia constitutiva.</p></li>
<li><p><strong>Declarante:</strong> El importador o consignatario, en el caso de la importación de mercancías.</p></li>
<li><p><strong>Depositario Aduanero:</strong> Persona física o jurídica, pública o privada, auxiliar de la función pública aduanera autorizadas mediante concesión por la DGA, que custodian y conservan temporalmente y con suspensión del pago de tributos, mercancías objeto de comercio exterior, bajo la supervisión y el control de la autoridad aduanera. (Ministerio de Hacienda, 2021).</p></li>
<li><p><strong>Derechos Arancelarios a la Importación (DAI):</strong> Derechos Arancelarios a la Importación que son un porcentaje estipulado por tipo de mercancías y se calcula sobre el Valor Aduanero.</p></li>
<li><p><strong>Descripción o designación de la mercancía:</strong> Precisa identificación de las características de ésta, sea de manera concreta, detallada, que singulariza de tal forma el objeto a clasificar que no deja duda alguna sobre su tipificación. (Quirós, 2024).</p></li>
<li><p><strong>DUA:</strong> Documento Único Aduanero, declaración realizada mediante transmisión electrónica de datos, mediante la cual se indica el régimen aduanero y la modalidad que deberá aplicarse a las mercancías (Ministerio de Hacienda, 2021).</p></li>
<li><p><strong>Empresa de entrega rápida (EER):</strong> Personas físicas o jurídicas legalmente establecidas, autorizadas y registradas ante la DGA, cuyo giro o actividad principal es la prestación de servicios de transporte internacional expreso a terceros, de correspondencia, documentos y envíos de mercancías bajo la modalidad de entrega rápida. (Ministerio de Hacienda, 2021).</p></li>
<li><p><strong>Envíos de entrega rápida:</strong> Documentos y mercancías transportadas bajo sistemas de entrega rápida o courier, consignadas a terceros. (Ministerio de Hacienda, 2021).</p></li>
<li><p><strong>Factura Comercial:</strong> Documento expedido conforme a los usos y las costumbres comerciales, justificativo de un contrato de compraventa de mercancías o servicios extendido por el vendedor a nombre y cargo del comprador.</p></li>
<li><p><strong>Fecha:</strong> Fecha en que fue aceptado el DUA por el Sistema de Tecnología de Información para el Control Aduanero (TICA) de Costa Rica.</p></li>
<li><p><strong>Flete:</strong> Monto de flete desde el origen, o sea desde el momento en que se elabora el conocimiento de embarque original y se inicia el servicio de transporte hasta el puerto o lugar de importación. (Ministerio de Hacienda, 2021).</p></li>
<li><p><strong>Identificación (ID) Agente:</strong> Cédula de identidad física u jurídica del Agente Aduanero.</p></li>
<li><p><strong>Identificación (ID) Declarante:</strong> En el caso que nos ataque, el número de identificación de la empresa declarante ante el Ministerio de Hacienda.</p></li>
<li><p><strong>Identificación (ID) Localización:</strong> Número de identificación de la empresa donde está localizada la mercancía, en el caso de envíos de courier, suele referirse al Depositario Aduanero o Almacén fiscal.</p></li>
<li><p><strong>Importador:</strong> Empresario o empresa que se dedica a comprar productos a clientes del exterior para luego venderlos en el mercado local o para consumo o uso propio.</p></li>
<li><p><strong>Impuesto sobre el Valor Agregado (IVA):</strong> Según el artículo 1 de la Ley 9635, el impuesto sobre el valor agregado se establece en la venta de bienes y en la prestación de servicios, independientemente del medio por el que sean prestados, realizados en el territorio en Costa Rica.</p></li>
<li><p><strong>Impuestos Selectivo de Consumo (SC):</strong> Impuesto establecido sobre bienes y servicios específicos, por razones que dependen de cada Estado. Entre las razones más comunes para gravar un bien específico se encuentra, por ejemplo, el carácter indemnizatorio o el desincentivador que se pretende implementar sobre o por el consumo o realización de este. Así, es que las bebidas alcohólicas, el tabaco, y la marihuana</p></li>
<li><p><strong>Impuestos:</strong> Los Derechos o impuestos a la importación corresponden al monto de tributos que el fisco recauda debido al ingreso de una mercancía extranjera al comercio nacional. (Ministerio de Hacienda, 2024).</p></li>
<li><p><strong>Ítem:</strong> Línea del DUA donde se describe e indica la cantidad de las mercancías que se presentan para ser destinadas a un régimen aduanero determinado.</p></li>
<li><p><strong>Ley 6946:</strong> Tarifa de Ley N°6946, de un 1% aplicable sobre el valor aduanero.</p></li>
<li><p><strong>Localización:</strong> véase Depositario Aduanero.</p></li>
<li><p><strong>Medio o modo de transporte:</strong> Nave, aeronave, vagón ferroviario, vehículo automotor, o cualquier otro medio utilizado para el transporte de personas o mercancías. (Ministerio de Hacienda, 2021)</p></li>
<li><p><strong>Mercancía:</strong> Objeto susceptible de ser apropiado y, por ende, importado o exportado, clasificado conforme al arancel de aduanas.</p></li>
<li><p><strong>Modalidad:</strong> Cada régimen aduanero contará con modalidades según detalle, por ejemplo, la importación puede ser modalidad importación definitiva, temporal, courier, entre otras.</p></li>
<li><p><strong>Modelo:</strong> De las mercancías que se adquieren, por ejemplo en sitios web y se trasladan a Costa Rica, bajo la modalidad de courier.</p></li>
<li><p><strong>Nota técnica:</strong> requisitos no arancelarios o autorizaciones preestablecidos por la institución rectora mediante leyes y decretos, que avalan el ingreso o salida de las mercancías del o al territorio nacional. (Ministerio de Hacienda, 2021)</p></li>
<li><p><strong>País de adquisición:</strong> País en donde se adquirido el servicio o mercancía.</p></li>
<li><p><strong>País de origen:</strong> País de donde, según lo establecido en el Tratado de Libre Comercio, son originarias las mercancías o servicios.</p></li>
<li><p><strong>País de procedencia:</strong> País de donde procede la mercancía, que no necesariamente coincide con el país de origen o de adquisición.</p></li>
<li><p><strong>Peso bruto:</strong> El peso bruto es el peso total de un producto más su empaque o contenedor.</p></li>
<li><p><strong>Peso neto:</strong> El peso neto de un producto, sea únicamente el peso del producto en sí.</p></li>
<li><p><strong>Precio FOB:</strong> FOB es un término comercial que pertenece a los Incoterms, corresponde a las siglas en inglés de ‘Free on board’. El Precio FOB se determina por: precio de la mercancía, el precio de embalaje y etiquetado, precio por transporte desde la planta de producción hasta el puerto de origen, el precio del seguro de la mercancía durante su traslado a puerto, gastos administrativos generados por la concesión de permisos o licencias, gastos derivados de las autoridades aduaneras, algunos gastos bancarios resultantes de pagos y transferencias internacionales y gastos portuarios, como uso de muelle, elevadores o estiba.</p></li>
<li><p><strong>PROCOMER:</strong> Promotora de Comercio Exterior de Costa Rica, pago de $3 por cada declaración aduanera transmitida electrónicamente, para la institución.</p></li>
<li><p><strong>Proveedor:</strong> Persona física o jurídica que suministra profesionalmente un determinado bien o servicio a otros individuos o sociedades, como forma de actividad económica y a cambio de una contra prestación.</p></li>
<li><p><strong>Régimen:</strong> Diferentes destinaciones a que pueden quedar sujetas las mercancías que se encuentran bajo control aduanero (Art 109. LGA)</p></li>
<li><p><strong>Seguro:</strong> Protección de la carga desde que sale del depósito del vendedor hasta las bodegas del comprador, o según INCOTERM.</p></li>
<li><p><strong>Unidad de medida:</strong> Referencia convencional que se usa para medir la magnitud física de un determinado objeto, sustancia o fenómeno.</p></li>
<li><p><strong>Valor CIF:</strong> Representa el precio total de la mercancía, incluyendo el coste, del seguro y el flete hasta el puerto de destino acordado.</p></li>
<li><p><strong>Valor en Aduana:</strong> El valor de transacción, o precio realmente pagado o por pagar por las mercancías cuando éstas se venden para su exportación al país de importación.</p></li>
</ul>
</section>
<section id="paso-1" class="level2">
<h2 class="anchored" data-anchor-id="paso-1"><strong>Paso 1:</strong></h2>
<p>Se inicia con una carga del conjunto de datos, ubicado en la carpeta ‘/data/raw/’ de nuestro directorio. Para evitar problemas de ubicación, se utiliza la variable parent_dir que representa el directorio padre de la solución.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lectura del archivo de datos y almacenamiento en variable data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_excel (parent_dir <span class="op">+</span> <span class="st">'/data/raw/data.xlsx'</span>, sheet_name<span class="op">=</span><span class="st">'UnifiedData'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DUA</th>
<th data-quarto-table-cell-role="th">Item del DUA</th>
<th data-quarto-table-cell-role="th">Fecha DUA</th>
<th data-quarto-table-cell-role="th">Aduana</th>
<th data-quarto-table-cell-role="th">Regimen</th>
<th data-quarto-table-cell-role="th">Modalidad</th>
<th data-quarto-table-cell-role="th">Importador</th>
<th data-quarto-table-cell-role="th">Proveedor</th>
<th data-quarto-table-cell-role="th">Marca</th>
<th data-quarto-table-cell-role="th">Modelo</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Total IVA US$</th>
<th data-quarto-table-cell-role="th">% Ley 6946</th>
<th data-quarto-table-cell-role="th">Total Ley 6946 US$</th>
<th data-quarto-table-cell-role="th">% DAI</th>
<th data-quarto-table-cell-role="th">Total DAI US$</th>
<th data-quarto-table-cell-role="th">COSTO por PROCOMER US$</th>
<th data-quarto-table-cell-role="th">% S.C</th>
<th data-quarto-table-cell-role="th">Total SC US$</th>
<th data-quarto-table-cell-role="th">Otros impuestos US$</th>
<th data-quarto-table-cell-role="th">Total de Impuestos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>005-2022-001495</td>
<td>1</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>6.45</td>
<td>1</td>
<td>0.43</td>
<td>14</td>
<td>6.04</td>
<td>3</td>
<td>0</td>
<td>0.00</td>
<td>0.11</td>
<td>16.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>005-2022-001495</td>
<td>2</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>92.12</td>
<td>1</td>
<td>5.61</td>
<td>14</td>
<td>78.49</td>
<td>0</td>
<td>10</td>
<td>63.91</td>
<td>0.00</td>
<td>240.13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>005-2022-001495</td>
<td>3</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>86.12</td>
<td>1</td>
<td>5.76</td>
<td>14</td>
<td>80.65</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>172.53</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>005-2022-001495</td>
<td>4</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>51.21</td>
<td>1</td>
<td>3.58</td>
<td>9</td>
<td>32.23</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>87.02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>005-2022-001495</td>
<td>5</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>9.54</td>
<td>1</td>
<td>0.64</td>
<td>14</td>
<td>8.94</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>19.12</td>
</tr>
</tbody>
</table>

<p>5 rows × 49 columns</p>
</div>
</div>
</div>
<p>2.2. Descripción de valores en columnas de datos — REVISARLO</p>
<ol type="1">
<li><strong>Año</strong>: Año en que se realizaron las importaciones.</li>
<li><strong>DUA</strong>: Documento Único Administrativo, identificador de la operación de importación.</li>
<li><strong>Item</strong>: Número de ítem en la factura.</li>
<li><strong>Fecha</strong>: Fecha de la operación de importación.</li>
<li><strong>Aduana</strong>: Aduana por la que ingresaron los productos.</li>
<li><strong>Regimen</strong>: Régimen aduanero bajo el cual se importaron los productos.</li>
<li><strong>Modalidad</strong>: Modalidad de importación.</li>
<li><strong>Importador</strong>: Empresa que importó los productos.</li>
<li><strong>Proveedor</strong>: Proveedor de los productos importados.</li>
<li><strong>Marca</strong>: Marca de los productos importados.</li>
<li><strong>Modelo</strong>: Modelo de los productos importados.</li>
<li><strong>Factura</strong>: Número de factura de la operación de importación.</li>
<li><strong>Código SAC</strong>: Código del Sistema Armonizado de Designación y Codificación de Mercancías.</li>
<li><strong>Vía Transporte</strong>: Vía por la que se transportaron los productos.</li>
<li><strong>País de Origen</strong>: País de origen de los productos.</li>
<li><strong>Pais de Procedencia</strong>: País de procedencia de los productos.</li>
<li><strong>Pais de Adquisición</strong>: País donde se adquirieron los productos.</li>
<li><strong>Cantidad Comercial</strong>: Cantidad de productos importados.</li>
<li><strong>Unidad de Medida</strong>: Unidad de medida de los productos importados.</li>
<li><strong>Volúmen Físico</strong>: Volumen físico de los productos importados.</li>
<li><strong>Bultos</strong>: Cantidad de bultos en los que se transportaron los productos.</li>
<li><strong>U$S FOB</strong>: Valor FOB (Free On Board) de los productos en dólares estadounidenses.</li>
<li><strong>U$S FOB Unit.</strong>: Valor unitario FOB de los productos en dólares estadounidenses.</li>
<li><strong>U$S Flete</strong>: Costo del flete en dólares estadounidenses.</li>
<li><strong>U$S Seguro</strong>: Costo del seguro en dólares estadounidenses.</li>
<li><strong>U$S CIF</strong>: Valor CIF (Cost, Insurance and Freight) de los productos en dólares estadounidenses.</li>
<li><strong>U$S Unitario</strong>: Valor unitario de los productos en dólares estadounidenses.</li>
<li><strong>Valor en Aduana U$S</strong>: Valor en aduana de los productos en dólares estadounidenses.</li>
<li><strong>Kg netos</strong>: Peso neto de los productos en kilogramos.</li>
<li><strong>Kg brutos</strong>: Peso bruto de los productos en kilogramos.</li>
<li><strong>Descripción de Mercancía</strong>: Descripción de los productos importados.</li>
<li><strong>ID Declarante</strong>: Identificador del declarante.</li>
<li><strong>Declarante</strong>: Nombre del declarante.</li>
<li><strong>ID Agente</strong>: Identificador del agente de aduanas.</li>
<li><strong>Agente</strong>: Nombre del agente de aduanas.</li>
<li><strong>ID Localización</strong>: Identificador de la localización.</li>
<li><strong>Localización</strong>: Localización de la operación de importación.</li>
<li><strong>% IVA</strong>: Porcentaje del Impuesto al Valor Agregado.</li>
<li><strong>IVA - U$S</strong>: Valor del IVA en dólares estadounidenses.</li>
<li><strong>% Ley 6946</strong>: Porcentaje de la Ley 6946.</li>
<li><strong>Ley 6946 U$S</strong>: Valor de la Ley 6946 en dólares estadounidenses.</li>
<li><strong>% DAI</strong>: Porcentaje del Derecho Arancelario de Importación.</li>
<li><strong>DAI U$S</strong>: Valor del DAI en dólares estadounidenses.</li>
<li><strong>PROCOMER U$S</strong>: Valor de PROCOMER en dólares estadounidenses.</li>
<li><strong>% S.C</strong>: Porcentaje de S.C.</li>
<li><strong>S.C. U$S</strong>: Valor de S.C en dólares estadounidenses.</li>
<li><strong>Otros Imp. U$S</strong>: Otros impuestos en dólares estadounidenses.</li>
<li><strong>Total de Impuestos</strong>: Total de impuestos de la operación de importación.</li>
<li><strong>Proporción Pr FOB / impuestos</strong>: Proporción entre el valor FOB y los impuestos.</li>
<li><strong>Proporción VA / impuestos</strong>: Proporción entre el valor en aduana y los impuestos.</li>
</ol>
<p>Se realiza un análisis descriptivo de los datos para…</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Métricas descriptivas de los datos</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Item del DUA</th>
<th data-quarto-table-cell-role="th">Fecha DUA</th>
<th data-quarto-table-cell-role="th">Código SAC</th>
<th data-quarto-table-cell-role="th">CodSA</th>
<th data-quarto-table-cell-role="th">Cantidad</th>
<th data-quarto-table-cell-role="th">Volúmen Físico</th>
<th data-quarto-table-cell-role="th">Cantidad de bultos</th>
<th data-quarto-table-cell-role="th">Valor FOB US$</th>
<th data-quarto-table-cell-role="th">Valor FOB US$ por unidad</th>
<th data-quarto-table-cell-role="th">Costo flete US$</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Peso bruto en Lbs.</th>
<th data-quarto-table-cell-role="th">ID Declarante</th>
<th data-quarto-table-cell-role="th">ID Agente Aduanero</th>
<th data-quarto-table-cell-role="th">Total IVA US$</th>
<th data-quarto-table-cell-role="th">Total Ley 6946 US$</th>
<th data-quarto-table-cell-role="th">Total DAI US$</th>
<th data-quarto-table-cell-role="th">COSTO por PROCOMER US$</th>
<th data-quarto-table-cell-role="th">Total SC US$</th>
<th data-quarto-table-cell-role="th">Otros impuestos US$</th>
<th data-quarto-table-cell-role="th">Total de Impuestos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>178434.000000</td>
<td>178434</td>
<td>1.784340e+05</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>...</td>
<td>178434.000000</td>
<td>1.784340e+05</td>
<td>1.784340e+05</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.000000</td>
<td>178434.00000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>63.527013</td>
<td>2022-06-23 05:30:13.497427712</td>
<td>7.354078e+11</td>
<td>7353.581459</td>
<td>1.891257</td>
<td>1.113133</td>
<td>0.755170</td>
<td>43.680059</td>
<td>37.911004</td>
<td>6.146155</td>
<td>...</td>
<td>9.459135</td>
<td>3.100034e+11</td>
<td>3.315567e+10</td>
<td>6.062704</td>
<td>0.376309</td>
<td>3.501689</td>
<td>0.066882</td>
<td>0.812547</td>
<td>0.003029</td>
<td>10.82316</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">min</td>
<td>1.000000</td>
<td>2021-01-04 00:00:00</td>
<td>2.508300e+11</td>
<td>2508.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>...</td>
<td>0.022046</td>
<td>1.087709e+08</td>
<td>1.087709e+08</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.00000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25%</td>
<td>12.000000</td>
<td>2021-08-05 00:00:00</td>
<td>6.206300e+11</td>
<td>6206.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>0.000000</td>
<td>8.400000</td>
<td>6.800000</td>
<td>2.330000</td>
<td>...</td>
<td>2.579382</td>
<td>3.101314e+11</td>
<td>1.104307e+08</td>
<td>0.250000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.59000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50%</td>
<td>46.000000</td>
<td>2022-04-06 00:00:00</td>
<td>8.409910e+11</td>
<td>8409.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>16.000000</td>
<td>13.180000</td>
<td>3.500000</td>
<td>...</td>
<td>5.136718</td>
<td>3.101314e+11</td>
<td>1.104307e+08</td>
<td>2.230000</td>
<td>0.140000</td>
<td>0.940000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.94000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75%</td>
<td>100.000000</td>
<td>2023-05-17 00:00:00</td>
<td>8.544421e+11</td>
<td>8544.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>1.000000</td>
<td>39.980000</td>
<td>32.780000</td>
<td>7.000000</td>
<td>...</td>
<td>11.023000</td>
<td>3.101314e+11</td>
<td>1.104307e+08</td>
<td>5.790000</td>
<td>0.360000</td>
<td>3.320000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>10.43000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">max</td>
<td>480.000000</td>
<td>2023-12-28 00:00:00</td>
<td>9.706900e+11</td>
<td>9706.000000</td>
<td>19100.000000</td>
<td>84.000000</td>
<td>23.000000</td>
<td>985.500000</td>
<td>985.500000</td>
<td>595.000000</td>
<td>...</td>
<td>639.334000</td>
<td>3.101607e+11</td>
<td>1.862004e+11</td>
<td>190.890000</td>
<td>11.530000</td>
<td>161.370000</td>
<td>3.000000</td>
<td>242.510000</td>
<td>12.000000</td>
<td>476.31000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>60.202672</td>
<td>NaN</td>
<td>1.844334e+11</td>
<td>1844.416160</td>
<td>47.754203</td>
<td>1.145816</td>
<td>0.517765</td>
<td>84.625879</td>
<td>77.876544</td>
<td>9.247828</td>
<td>...</td>
<td>20.994796</td>
<td>6.438089e+09</td>
<td>7.109965e+10</td>
<td>12.400669</td>
<td>0.797761</td>
<td>8.447561</td>
<td>0.442915</td>
<td>5.652555</td>
<td>0.065990</td>
<td>23.05286</td>
</tr>
</tbody>
</table>

<p>8 rows × 26 columns</p>
</div>
</div>
</div>
<p>Se verifica la existencia de valores nulos en el conjunto de datos</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Revisión de valores faltantes</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>DUA                         0
Item del DUA                0
Fecha DUA                   0
Aduana                      0
Regimen                     0
Modalidad                   0
Importador                  0
Proveedor                   0
Marca                       0
Modelo                      0
Factura                     0
Código SAC                  0
CodSA                       0
Modo transporte             0
País de Origen              0
Pais de Procedencia         0
Pais de Adquisición         0
Cantidad                    0
Unidad de Medida            0
Volúmen Físico              0
Cantidad de bultos          0
Valor FOB US$               0
Valor FOB US$ por unidad    0
Costo flete US$             0
Costo seguro US$            0
Valor CIF US$               0
Valor CIF US$  unitario     0
Valor en Aduana US$         0
Peso neto Kg.               0
Peso bruto Kg.              0
Peso bruto en Lbs.          0
Descripción de Mercancía    0
ID Declarante               0
Declarante                  0
ID Agente Aduanero          0
Agente aduanero             0
ID Localización             0
Localización                0
% IVA                       0
Total IVA US$               0
% Ley 6946                  0
Total Ley 6946 US$          0
% DAI                       0
Total DAI US$               0
COSTO por PROCOMER US$      0
% S.C                       0
Total SC US$                0
Otros impuestos US$         0
Total de Impuestos          0
dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Año'</span>] <span class="op">=</span> data[<span class="st">'DUA'</span>].<span class="bu">str</span>[<span class="dv">4</span>:<span class="dv">8</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Mover la columna Anno a la primera posición</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>año <span class="op">=</span> data.pop(<span class="st">'Año'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>data.insert(<span class="dv">0</span>, <span class="st">'Año'</span>, año)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Año</th>
<th data-quarto-table-cell-role="th">DUA</th>
<th data-quarto-table-cell-role="th">Item del DUA</th>
<th data-quarto-table-cell-role="th">Fecha DUA</th>
<th data-quarto-table-cell-role="th">Aduana</th>
<th data-quarto-table-cell-role="th">Regimen</th>
<th data-quarto-table-cell-role="th">Modalidad</th>
<th data-quarto-table-cell-role="th">Importador</th>
<th data-quarto-table-cell-role="th">Proveedor</th>
<th data-quarto-table-cell-role="th">Marca</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Total IVA US$</th>
<th data-quarto-table-cell-role="th">% Ley 6946</th>
<th data-quarto-table-cell-role="th">Total Ley 6946 US$</th>
<th data-quarto-table-cell-role="th">% DAI</th>
<th data-quarto-table-cell-role="th">Total DAI US$</th>
<th data-quarto-table-cell-role="th">COSTO por PROCOMER US$</th>
<th data-quarto-table-cell-role="th">% S.C</th>
<th data-quarto-table-cell-role="th">Total SC US$</th>
<th data-quarto-table-cell-role="th">Otros impuestos US$</th>
<th data-quarto-table-cell-role="th">Total de Impuestos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2022</td>
<td>005-2022-001495</td>
<td>1</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>6.45</td>
<td>1</td>
<td>0.43</td>
<td>14</td>
<td>6.04</td>
<td>3</td>
<td>0</td>
<td>0.00</td>
<td>0.11</td>
<td>16.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2022</td>
<td>005-2022-001495</td>
<td>2</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>92.12</td>
<td>1</td>
<td>5.61</td>
<td>14</td>
<td>78.49</td>
<td>0</td>
<td>10</td>
<td>63.91</td>
<td>0.00</td>
<td>240.13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2022</td>
<td>005-2022-001495</td>
<td>3</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>86.12</td>
<td>1</td>
<td>5.76</td>
<td>14</td>
<td>80.65</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>172.53</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2022</td>
<td>005-2022-001495</td>
<td>4</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>51.21</td>
<td>1</td>
<td>3.58</td>
<td>9</td>
<td>32.23</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>87.02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2022</td>
<td>005-2022-001495</td>
<td>5</td>
<td>2022-01-03</td>
<td>SANTAMARIA</td>
<td>IMPORTACION DEFINITIVA</td>
<td>ENTREGA RAPIDA</td>
<td>SwiftShip</td>
<td>No disponible</td>
<td>No disponible</td>
<td>...</td>
<td>9.54</td>
<td>1</td>
<td>0.64</td>
<td>14</td>
<td>8.94</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>19.12</td>
</tr>
</tbody>
</table>

<p>5 rows × 50 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se cuenta con información de dos años completos</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>distinct_values <span class="op">=</span> data[<span class="st">'Año'</span>].unique()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(distinct_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['2022' '2023' '2021']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['Año', 'DUA', 'Item del DUA', 'Fecha DUA', 'Aduana', 'Regimen',
       'Modalidad', 'Importador', 'Proveedor', 'Marca', 'Modelo', 'Factura',
       'Código SAC', 'CodSA', 'Modo transporte', 'País de Origen',
       'Pais de Procedencia', 'Pais de Adquisición', 'Cantidad',
       'Unidad de Medida', 'Volúmen Físico', 'Cantidad de bultos',
       'Valor FOB US$', 'Valor FOB US$ por unidad', 'Costo flete US$',
       'Costo seguro US$', 'Valor CIF US$', 'Valor CIF US$  unitario',
       'Valor en Aduana US$', 'Peso neto Kg.', 'Peso bruto Kg.',
       'Peso bruto en Lbs.', 'Descripción de Mercancía', 'ID Declarante',
       'Declarante', 'ID Agente Aduanero', 'Agente aduanero',
       'ID Localización', 'Localización', '% IVA', 'Total IVA US$',
       '% Ley 6946', 'Total Ley 6946 US$', '% DAI', 'Total DAI US$',
       'COSTO por PROCOMER US$', '% S.C', 'Total SC US$',
       'Otros impuestos US$', 'Total de Impuestos'],
      dtype='object')</code></pre>
</div>
</div>
<section id="proceso-de-creación-y-conexión-a-base-de-datos" class="level3">
<h3 class="anchored" data-anchor-id="proceso-de-creación-y-conexión-a-base-de-datos">Proceso de creación y conexión a base de datos</h3>
<p>Una vez ordenados y definida la información es necesario respaldar los datos en la base de datos. Para esto, se utiliza una base de datos SQLlite para almacenarlos.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to the SQLite database</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># SalvarEnBD('FactDatosCouriers', data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data.hist(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#bank_data.histo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="crisp-dm-couriers_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>ESTO HAY QUE DEFINIR PARA QUÉ nos sirve</p>
</section>
</section>
<section id="análisis-de-la-cantidad-de-duas-por-mes-y-código-sac" class="level2">
<h2 class="anchored" data-anchor-id="análisis-de-la-cantidad-de-duas-por-mes-y-código-sac">Análisis de la cantidad de DUAs por Mes y Código SAC</h2>
<p>Para realizar un análisis más detallado de la cantidad de DUAs por mes y código SAC, hemos utilizado Python y Plotly para crear un gráfico de barras interactivo. Este gráfico nos permite visualizar la distribución de la cantidad de DUAs para un importador específico en un año determinado.</p>
<section id="procedimiento" class="level3">
<h3 class="anchored" data-anchor-id="procedimiento">Procedimiento</h3>
<ol type="1">
<li><p><strong>Filtrado de datos</strong>: Primero, hemos filtrado los datos para seleccionar un año específico y un importador particular. En este caso, hemos seleccionado el año 2022 y el importador ‘LIBERTY EXPRESS CORPORATE VC SOCIEDAD AN’.</p></li>
<li><p><strong>Agrupación de datos</strong>: Luego, hemos agrupado los datos filtrados por mes y código SAC, contando la cantidad de DUAs en cada grupo.</p></li>
<li><p><strong>Creación del gráfico de barras</strong>: Utilizando Plotly Express, hemos creado un gráfico de barras que muestra la cantidad de DUAs por mes y código SAC para el año e importador seleccionados. Cada barra representa la cantidad de DUAs asociadas a un código SAC específico en un mes determinado.</p></li>
</ol>
</section>
<section id="interpretación" class="level3">
<h3 class="anchored" data-anchor-id="interpretación">Interpretación</h3>
<p>Este gráfico nos permite identificar patrones o tendencias en la distribución de la cantidad de DUAs para el importador seleccionado a lo largo del año 2022. Podemos observar qué tipos de productos (definidos por el código SAC) tienen una mayor o menor incidencia en diferentes meses del año, lo que puede proporcionar información útil para la planificación y la toma de decisiones estratégicas en la gestión de importaciones.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Group the data by year, importador, month, and Código SAC and count the number of DUAs</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>duas_by_year_importador_month_sac <span class="op">=</span> data.groupby([<span class="st">'Año'</span>, <span class="st">'Importador'</span>, <span class="st">'Mes'</span>, <span class="st">'Código SAC'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'Cantidad_DUAs'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the graph for all importers and years</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar(duas_by_year_importador_month_sac, x<span class="op">=</span><span class="st">'Mes'</span>, y<span class="op">=</span><span class="st">'Cantidad_DUAs'</span>, color<span class="op">=</span><span class="st">'Código SAC'</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>             facet_col<span class="op">=</span><span class="st">'Año'</span>, facet_row<span class="op">=</span><span class="st">'Importador'</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>             labels<span class="op">=</span>{<span class="st">'Mes'</span>: <span class="st">'Mes'</span>, <span class="st">'Cantidad_DUAs'</span>: <span class="st">'Cantidad de DUAs'</span>, <span class="st">'Código SAC'</span>: <span class="st">'Código SAC'</span>},</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>             width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">600</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the layout of the graph</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>fig.update_layout(title<span class="op">=</span><span class="st">'Cantidad de DUAs por Mes y Código SAC para todos los importadores y años'</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                  xaxis_title<span class="op">=</span><span class="st">'Mes'</span>, yaxis_title<span class="op">=</span><span class="st">'Cantidad de DUAs'</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the graph</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>Este código es útil para el análisis de datos ya que permite visualizar las 20 principales operaciones de importación (DUAs) en términos de U$S FOB. FOB (Free On Board) es un término de comercio internacional que indica el valor de los bienes en el punto de embarque, es decir, el valor de los bienes antes de ser exportados.</p>
<p>Al visualizar estos datos, los analistas pueden identificar rápidamente cuáles son las operaciones de importación más valiosas en términos de U$S FOB. Esto puede ser útil para identificar tendencias, patrones o anomalías en los datos, lo que puede informar decisiones comerciales o estratégicas</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_top_20_duas(data):</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot the top 20 DUAs by U$S FOB using plotly.express.</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">    - data (pandas.DataFrame): The input DataFrame containing the data.</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">    - None</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the DataFrame to include only the top 20 DUAs</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    top_20_duas <span class="op">=</span> data[<span class="st">'DUA'</span>].value_counts().head(<span class="dv">20</span>).index</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    filtered_data <span class="op">=</span> data[data[<span class="st">'DUA'</span>].isin(top_20_duas)]</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Aggregate the data to get the sum of U$S FOB for each DUA</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    aggregated_data <span class="op">=</span> filtered_data.groupby(<span class="st">'DUA'</span>)[<span class="st">'Valor FOB US$'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    aggregated_data <span class="op">=</span> aggregated_data.sort_values(by<span class="op">=</span><span class="st">'Valor FOB US$'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the graphic using the filtered data</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> px.bar(aggregated_data, x<span class="op">=</span><span class="st">'DUA'</span>, y<span class="op">=</span><span class="st">'Valor FOB US$'</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                 labels<span class="op">=</span>{<span class="st">'DUA'</span>: <span class="st">'DUA'</span>, <span class="st">'Valor FOB US$'</span>: <span class="st">'Valor FOB US$'</span>},</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                 title<span class="op">=</span><span class="st">'Top 20 DUAs by Valor FOB US$'</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(xaxis_tickangle<span class="op">=-</span><span class="dv">90</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage (assuming 'data' is your DataFrame):</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># data = pd.read_csv('your_data.csv')  # Replace with your data source</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>plot_top_20_duas(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>??? Porque CIF?</p>
<p>U$S CIF vs.&nbsp;Kg netos: Esta comparación puede ayudar a entender si hay alguna relación entre el costo de las mercancías y su peso neto. Podría ser útil para identificar si los productos más pesados tienden a ser más costosos o si existe alguna otra relación entre estas dos variables.</p>
</section>
<section id="pendiente-definir-si-esto-nos-sirve" class="level3">
<h3 class="anchored" data-anchor-id="pendiente-definir-si-esto-nos-sirve">PENDIENTE DEFINIR SI ESTO NOS SIRVE</h3>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#import plotly.express as px</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the scatter plot with different colors based on the importer and hover information including 'Descripción de Mercancía'</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>fig_cif_vs_kg <span class="op">=</span> px.scatter(data, x<span class="op">=</span><span class="st">'Peso neto Kg.'</span>, y<span class="op">=</span><span class="st">'Valor CIF US$'</span>, color<span class="op">=</span><span class="st">'Importador'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                           title<span class="op">=</span><span class="st">'U$S CIF vs. Kg netos'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                           hover_data<span class="op">=</span>{<span class="st">'Descripción de Mercancía'</span>: <span class="va">True</span>})</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>fig_cif_vs_kg.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
</section>
</section>
<section id="visualización-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="visualización-de-datos">Visualización de Datos</h2>
<p>Comparar las cantidades importadas por las dos empresas en cada año.</p>
</section>
<section id="análisis-de-cantidades-importadas-por-empresa-y-año" class="level2">
<h2 class="anchored" data-anchor-id="análisis-de-cantidades-importadas-por-empresa-y-año">Análisis de Cantidades Importadas por Empresa y Año</h2>
<p>Este bloque de código contribuye significativamente a la etapa de <strong>Entendimiento de los Datos</strong> en el estudio CRISP-DM para las operaciones de importación de las empresas SwiftShip y ExpediteX en Costa Rica. La función <code>create_pivot_table</code> y <code>plot_pivot_table</code> trabajan en conjunto para transformar y visualizar los datos de importaciones, facilitando la identificación de tendencias y patrones en las cantidades importadas por cada empresa a lo largo de los años. A continuación, se detalla cómo cada función apoya este análisis:</p>
<section id="create_pivot_tabledata" class="level3">
<h3 class="anchored" data-anchor-id="create_pivot_tabledata"><code>create_pivot_table(data)</code></h3>
<ul>
<li><strong>Objetivo</strong>: Crear una tabla pivote que resume las cantidades totales importadas por cada importador (empresa) por año.</li>
<li><strong>Proceso</strong>: La función toma como entrada el conjunto de datos de importaciones, agrupa las cantidades (<code>Cantidad</code>) por año (<code>Año</code>) y por importador (<code>Importador</code>), y suma estas cantidades para cada combinación de año e importador.</li>
<li><strong>Resultado</strong>: Una tabla pivote que facilita la comparación de las cantidades importadas por cada empresa a lo largo del tiempo, lo cual es esencial para entender la dinámica del mercado y la participación de cada empresa.</li>
</ul>
</section>
<section id="plot_pivot_tablepivot_df" class="level3">
<h3 class="anchored" data-anchor-id="plot_pivot_tablepivot_df"><code>plot_pivot_table(pivot_df)</code></h3>
<ul>
<li><strong>Objetivo</strong>: Visualizar las cantidades importadas por cada empresa a lo largo de los años.</li>
<li><strong>Proceso</strong>: Transforma la tabla pivote en un formato largo adecuado para la visualización con Plotly, y luego crea un gráfico de barras apiladas que muestra las cantidades importadas por año y por empresa.</li>
<li><strong>Resultado</strong>: Un gráfico claro y atractivo que permite identificar visualmente tendencias, patrones estacionales, y cambios en la demanda de importaciones entre las empresas SwiftShip y ExpediteX a lo largo del tiempo.</li>
</ul>
</section>
<section id="impacto-en-el-estudio-crisp-dm" class="level3">
<h3 class="anchored" data-anchor-id="impacto-en-el-estudio-crisp-dm">Impacto en el Estudio CRISP-DM</h3>
<p>Este bloque de código es fundamental para la fase de <strong>Entendimiento de los Datos</strong>, ya que proporciona insights visuales inmediatos sobre cómo las cantidades importadas varían entre las empresas y a lo largo de los años. Estos insights son cruciales para: - Identificar tendencias de crecimiento o declive en las importaciones. - Reconocer la estacionalidad y cómo ciertos eventos o periodos del año afectan las cantidades importadas. - Preparar el terreno para análisis más profundos, como el análisis de cesta y el análisis de series temporales, al destacar los años o importadores que podrían requerir atención especial.</p>
<p>En resumen, este bloque de código mejora significativamente la comprensión de los patrones de importación y es un paso esencial hacia el logro de los objetivos específicos del proyecto.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_pivot_table(data):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    pivot_df <span class="op">=</span> data.pivot_table(index<span class="op">=</span><span class="st">'Año'</span>, columns<span class="op">=</span><span class="st">'Importador'</span>, values<span class="op">=</span><span class="st">'Cantidad'</span>, aggfunc<span class="op">=</span><span class="st">'sum'</span>).reset_index()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    plot_pivot_table(pivot_df)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_pivot_table(pivot_df):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Preparar los datos para Plotly</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    pivot_df_long <span class="op">=</span> pivot_df.melt(id_vars<span class="op">=</span><span class="st">'Año'</span>, var_name<span class="op">=</span><span class="st">'Importador'</span>, value_name<span class="op">=</span><span class="st">'Cantidad'</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Crear el gráfico de barras con Plotly</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> px.bar(pivot_df_long, x<span class="op">=</span><span class="st">'Año'</span>, y<span class="op">=</span><span class="st">'Cantidad'</span>, color<span class="op">=</span><span class="st">'Importador'</span>, title<span class="op">=</span><span class="st">'Cantidades Importadas por Cada Empresa Cada Año'</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                 labels<span class="op">=</span>{<span class="st">'Cantidad'</span>: <span class="st">'Cantidad Importada'</span>, <span class="st">'Año'</span>: <span class="st">'Año'</span>}, barmode<span class="op">=</span><span class="st">'stack'</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mostrar el gráfico</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>create_pivot_table(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
</section>
</section>
<section id="us-cif-vs.-año-con-importador" class="level2">
<h2 class="anchored" data-anchor-id="us-cif-vs.-año-con-importador">U$S CIF vs.&nbsp;Año con Importador</h2>
<p>Comparar el costo de las mercancías a lo largo de los años puede revelar tendencias o patrones en los precios a lo largo del tiempo. Agregar la variable ‘Importador’ al gráfico de dispersión nos permite examinar cómo varía el costo CIF en función del año, y además nos brinda información sobre diferentes importadores y su impacto en los precios. Esto puede ser útil para identificar si hay algún importador en particular que tenga una influencia significativa en los costos de las mercancías a lo largo de los años, lo que podría llevar a investigaciones adicionales sobre prácticas de importación, cambios en los proveedores o políticas comerciales.</p>
<section id="idea-de-gráfico-1" class="level3">
<h3 class="anchored" data-anchor-id="idea-de-gráfico-1">idea de gráfico 1</h3>
<section id="esto-no-me-gusta" class="level4">
<h4 class="anchored" data-anchor-id="esto-no-me-gusta">ESTO NO ME GUSTA</h4>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico de dispersión para U$S CIF vs. Anno con la variable 'Importador'</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fig_cif_anno_importador <span class="op">=</span> px.scatter(data, x<span class="op">=</span><span class="st">'Año'</span>, y<span class="op">=</span><span class="st">'Valor CIF US$'</span>, color<span class="op">=</span><span class="st">'Importador'</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                     title<span class="op">=</span><span class="st">'U$S CIF vs. Año con Importador'</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                                     labels<span class="op">=</span>{<span class="st">'Año'</span>: <span class="st">'Año'</span>, <span class="st">'U$S CIF'</span>: <span class="st">'Valor CIF US'</span>},</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                     width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">600</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar el gráfico</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>fig_cif_anno_importador.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="ingeniería-de-variables" class="level2">
<h2 class="anchored" data-anchor-id="ingeniería-de-variables">INGENIERÍA DE VARIABLES</h2>
<p>Se agregan dos variables al conjunto de datos para obtener información adicional durante el análisis</p>
<ul>
<li>Proporción de impuestos sobre el valor FOB: Incluir como ayuda esto al análisis</li>
<li>Proporción de impuestso sobre el valor aduanero</li>
</ul>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Proporción de impuestos sobre el valor FOB'</span>] <span class="op">=</span> (data[<span class="st">'Total de Impuestos'</span>] <span class="op">*</span> data[<span class="st">"Valor FOB US$"</span>]) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Proporción de los impuestos sobre el valor aduanero'</span>] <span class="op">=</span> (data[<span class="st">'Total de Impuestos'</span>] <span class="op">*</span> data[<span class="st">"Valor en Aduana US$"</span>]) <span class="op">/</span> <span class="dv">100</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="modelado" class="level1">
<h1><strong>3. MODELADO</strong></h1>
<section id="basket-analysis-utilizando-el-algoritmo-apriori" class="level2">
<h2 class="anchored" data-anchor-id="basket-analysis-utilizando-el-algoritmo-apriori">Basket Analysis utilizando el algoritmo Apriori</h2>
<section id="paso-1-preparación-de-los-datos" class="level3">
<h3 class="anchored" data-anchor-id="paso-1-preparación-de-los-datos"><strong>Paso 1: Preparación de los datos</strong></h3>
<p>En el primer paso del Basket Analysis, estamos preparando nuestros datos para el análisis. Los datos deben estar en un formato específico para que el algoritmo Apriori pueda procesarlos. Este formato se conoce como “one-hot encoding”.</p>
<p>En “one-hot encoding”, cada fila de los datos representa una transacción (en nuestro caso, identificada por la columna ‘DUA’) y cada columna representa un artículo (identificado por la columna ‘CodSA’- Código Sistema Armonizado). Si un artículo específico está presente en una transacción, el valor en la celda correspondiente es 1, y si no está presente, el valor es 0.</p>
<p>Esto nos permite tener una representación binaria de nuestras transacciones, que es el formato requerido para el algoritmo Apriori.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agrupamos por 'DUA' y 'DescripcionPartida', deshacemos el apilamiento de los artículos y llenamos los valores NA con 0</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>basket <span class="op">=</span> (data</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>          .groupby([<span class="st">'DUA'</span>, <span class="st">'CodSA'</span>])[<span class="st">'CodSA'</span>]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>          .count().unstack().reset_index().fillna(<span class="dv">0</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>          .set_index(<span class="st">'DUA'</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos las unidades a valores codificados en caliente (1 hot encoded)</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> codificar_unidades(x):</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;=</span> <span class="dv">1</span>:</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>conjuntos_cesta <span class="op">=</span> basket.applymap(codificar_unidades)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostramos las primeras filas del DataFrame resultante</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>conjuntos_cesta.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">CodSA</th>
<th data-quarto-table-cell-role="th">2508</th>
<th data-quarto-table-cell-role="th">2513</th>
<th data-quarto-table-cell-role="th">2526</th>
<th data-quarto-table-cell-role="th">3006</th>
<th data-quarto-table-cell-role="th">3402</th>
<th data-quarto-table-cell-role="th">3405</th>
<th data-quarto-table-cell-role="th">3406</th>
<th data-quarto-table-cell-role="th">3407</th>
<th data-quarto-table-cell-role="th">3506</th>
<th data-quarto-table-cell-role="th">3701</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">9613</th>
<th data-quarto-table-cell-role="th">9614</th>
<th data-quarto-table-cell-role="th">9615</th>
<th data-quarto-table-cell-role="th">9616</th>
<th data-quarto-table-cell-role="th">9617</th>
<th data-quarto-table-cell-role="th">9618</th>
<th data-quarto-table-cell-role="th">9619</th>
<th data-quarto-table-cell-role="th">9620</th>
<th data-quarto-table-cell-role="th">9701</th>
<th data-quarto-table-cell-role="th">9706</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">DUA</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">005-2021-000324</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">005-2021-000341</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">005-2021-002548</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">005-2021-002659</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">005-2021-002660</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>5 rows × 456 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Salvar el resultado en la base de datos</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#SalvarEnBD('BasketAnalysis_OneHotEncoding', data)</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># No se guarda en base de datos por tamaño del archivo </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="paso-2-generación-de-conjuntos-de-artículos-frecuentes" class="level3">
<h3 class="anchored" data-anchor-id="paso-2-generación-de-conjuntos-de-artículos-frecuentes"><strong>Paso 2: Generación de conjuntos de artículos frecuentes</strong></h3>
<p>El siguiente paso en el Basket Analysis es generar conjuntos de artículos frecuentes. Estos son conjuntos de artículos que aparecen juntos en las transacciones con más frecuencia que un umbral especificado. Para hacer esto, utilizamos la función apriori de la biblioteca mlxtend.</p>
<p>La función apriori toma dos argumentos principales: el DataFrame que contiene nuestros datos y un valor mínimo de soporte. El soporte es una medida de cuán frecuentemente aparece un conjunto de artículos en las transacciones. Al especificar un valor mínimo de soporte, le decimos a la función apriori que sólo queremos los conjuntos de artículos que aparecen en al menos ese porcentaje de las transacciones.</p>
<p>Para efectos de este estudio, se define el valor mínimo de soporte en 0.20</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construimos los conjuntos de artículos frecuentes</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>conjuntos_cesta_bool <span class="op">=</span> conjuntos_cesta.astype(<span class="bu">bool</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate frequent itemsets</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>conjuntos_frecuentes <span class="op">=</span> apriori(conjuntos_cesta_bool, min_support<span class="op">=</span><span class="fl">0.20</span>, use_colnames<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few frequent itemsets</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>conjuntos_frecuentes.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">support</th>
<th data-quarto-table-cell-role="th">itemsets</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.217672</td>
<td>(3923)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.297653</td>
<td>(3924)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.511734</td>
<td>(3926)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.210010</td>
<td>(4016)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.534962</td>
<td>(4202)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="paso-3-generación-de-las-reglas" class="level3">
<h3 class="anchored" data-anchor-id="paso-3-generación-de-las-reglas"><strong>Paso 3: Generación de las reglas</strong></h3>
<p>En este paso, generamos las reglas a partir de los conjuntos de ítems frecuentes. Estas reglas representan patrones en los datos donde la presencia de ciertos ítems en una transacción implica la presencia de otros ítems. Para hacer esto, utilizamos la función association_rules de la biblioteca mlxtend.</p>
<p>La función association_rules toma dos argumentos principales: el DataFrame de conjuntos de ítems frecuentes y una métrica para evaluar las reglas. La métrica puede ser ‘support’, ‘confidence’ o ‘lift’, y determina qué reglas se consideran interesantes. También especificamos un umbral mínimo para la métrica.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the rules</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>rules <span class="op">=</span> association_rules(conjuntos_frecuentes, metric<span class="op">=</span><span class="st">"confidence"</span>, min_threshold<span class="op">=</span><span class="fl">0.70</span>)   <span class="co">## Lo que indicó Ramón hay que documentarlo</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rules</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>rules.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">antecedents</th>
<th data-quarto-table-cell-role="th">consequents</th>
<th data-quarto-table-cell-role="th">antecedent support</th>
<th data-quarto-table-cell-role="th">consequent support</th>
<th data-quarto-table-cell-role="th">support</th>
<th data-quarto-table-cell-role="th">confidence</th>
<th data-quarto-table-cell-role="th">lift</th>
<th data-quarto-table-cell-role="th">leverage</th>
<th data-quarto-table-cell-role="th">conviction</th>
<th data-quarto-table-cell-role="th">zhangs_metric</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>(3924)</td>
<td>(3926)</td>
<td>0.297653</td>
<td>0.511734</td>
<td>0.227969</td>
<td>0.765889</td>
<td>1.496655</td>
<td>0.075650</td>
<td>2.085619</td>
<td>0.472478</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>(3924)</td>
<td>(4202)</td>
<td>0.297653</td>
<td>0.534962</td>
<td>0.238266</td>
<td>0.800483</td>
<td>1.496337</td>
<td>0.079033</td>
<td>2.330817</td>
<td>0.472275</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>(3924)</td>
<td>(4901)</td>
<td>0.297653</td>
<td>0.358477</td>
<td>0.209531</td>
<td>0.703942</td>
<td>1.963702</td>
<td>0.102829</td>
<td>2.166883</td>
<td>0.698740</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>(3924)</td>
<td>(6404)</td>
<td>0.297653</td>
<td>0.370450</td>
<td>0.209531</td>
<td>0.703942</td>
<td>1.900234</td>
<td>0.099265</td>
<td>2.126441</td>
<td>0.674523</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>(3924)</td>
<td>(9503)</td>
<td>0.297653</td>
<td>0.623084</td>
<td>0.253113</td>
<td>0.850362</td>
<td>1.364762</td>
<td>0.067650</td>
<td>2.518851</td>
<td>0.380541</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;ruby&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the file path and name for the Excel file</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> parent_dir <span class="op">+</span> <span class="st">'/data/procesed/rules.xlsx'</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the DataFrame to Excel</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>rules.to_excel(file_path, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="paso-4-análisis-e-interpretación-de-las-reglas" class="level3">
<h3 class="anchored" data-anchor-id="paso-4-análisis-e-interpretación-de-las-reglas"><strong>Paso 4: Análisis e Interpretación de las Reglas</strong></h3>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenamos las reglas por lift en orden descendente, siguiendo consejo de D. Ramón</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>reglas_ordenadas_por_lift <span class="op">=</span> rules.sort_values(<span class="st">'lift'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostramos las primeras reglas</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>reglas_ordenadas_por_lift.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">antecedents</th>
<th data-quarto-table-cell-role="th">consequents</th>
<th data-quarto-table-cell-role="th">antecedent support</th>
<th data-quarto-table-cell-role="th">consequent support</th>
<th data-quarto-table-cell-role="th">support</th>
<th data-quarto-table-cell-role="th">confidence</th>
<th data-quarto-table-cell-role="th">lift</th>
<th data-quarto-table-cell-role="th">leverage</th>
<th data-quarto-table-cell-role="th">conviction</th>
<th data-quarto-table-cell-role="th">zhangs_metric</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">825</td>
<td>(6404, 4901, 9503)</td>
<td>(6403)</td>
<td>0.257184</td>
<td>0.236351</td>
<td>0.200192</td>
<td>0.778399</td>
<td>3.293406</td>
<td>0.139406</td>
<td>3.446048</td>
<td>0.937464</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">830</td>
<td>(6403)</td>
<td>(6404, 4901, 9503)</td>
<td>0.236351</td>
<td>0.257184</td>
<td>0.200192</td>
<td>0.847011</td>
<td>3.293406</td>
<td>0.139406</td>
<td>4.855361</td>
<td>0.911888</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">828</td>
<td>(6403, 9503)</td>
<td>(6404, 4901)</td>
<td>0.229646</td>
<td>0.266284</td>
<td>0.200192</td>
<td>0.871741</td>
<td>3.273734</td>
<td>0.139041</td>
<td>5.720602</td>
<td>0.901583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">829</td>
<td>(6404, 4901)</td>
<td>(6403, 9503)</td>
<td>0.266284</td>
<td>0.229646</td>
<td>0.200192</td>
<td>0.751799</td>
<td>3.273734</td>
<td>0.139041</td>
<td>3.103747</td>
<td>0.946603</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">915</td>
<td>(4202, 6404, 3926)</td>
<td>(4901, 8471)</td>
<td>0.245929</td>
<td>0.252155</td>
<td>0.200431</td>
<td>0.814995</td>
<td>3.232117</td>
<td>0.138419</td>
<td>4.042298</td>
<td>0.915836</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>rules[<span class="st">'antecedents'</span>] <span class="op">=</span> rules[<span class="st">'antecedents'</span>].<span class="bu">apply</span>(<span class="bu">list</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>rules[<span class="st">'consequents'</span>] <span class="op">=</span> rules[<span class="st">'consequents'</span>].<span class="bu">apply</span>(<span class="bu">list</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the scatter plot</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(rules, x<span class="op">=</span><span class="st">"support"</span>, y<span class="op">=</span><span class="st">"confidence"</span>, size<span class="op">=</span><span class="st">"lift"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                 hover_data<span class="op">=</span>[<span class="st">'antecedents'</span>, <span class="st">'consequents'</span>],</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                 size_max<span class="op">=</span><span class="dv">60</span>, title<span class="op">=</span><span class="st">"Reglas de Asociación: Soporte vs. Confianza"</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Update axes titles</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">'Soporte'</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">'Confianza'</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the height of the plot</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>fig.update_layout(height<span class="op">=</span><span class="dv">800</span>)  <span class="co"># Set the height to 800 pixels</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a graph</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.Graph()</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Add nodes and edges from the rules DataFrame</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> rules.iterrows():</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    antecedents <span class="op">=</span> <span class="st">', '</span>.join(<span class="bu">str</span>(item) <span class="cf">for</span> item <span class="kw">in</span> row[<span class="st">'antecedents'</span>])</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    consequents <span class="op">=</span> <span class="st">', '</span>.join(<span class="bu">str</span>(item) <span class="cf">for</span> item <span class="kw">in</span> row[<span class="st">'consequents'</span>])</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    G.add_node(antecedents, <span class="bu">type</span><span class="op">=</span><span class="st">'antecedent'</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    G.add_node(consequents, <span class="bu">type</span><span class="op">=</span><span class="st">'consequent'</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    G.add_edge(antecedents, consequents, weight<span class="op">=</span>row[<span class="st">'lift'</span>])</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the spring layout with a larger k value for more separation</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>pos <span class="op">=</span> nx.spring_layout(G, k<span class="op">=</span><span class="fl">0.15</span>)  <span class="co"># Increase k to spread nodes further apart</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create edge traces</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>edge_x <span class="op">=</span> []</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>edge_y <span class="op">=</span> []</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> edge <span class="kw">in</span> G.edges():</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    x0, y0 <span class="op">=</span> pos[edge[<span class="dv">0</span>]]</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    x1, y1 <span class="op">=</span> pos[edge[<span class="dv">1</span>]]</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    edge_x.extend([x0, x1, <span class="va">None</span>])</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    edge_y.extend([y0, y1, <span class="va">None</span>])</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>edge_trace <span class="op">=</span> go.Scatter(x<span class="op">=</span>edge_x, y<span class="op">=</span>edge_y, line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'#888'</span>), hoverinfo<span class="op">=</span><span class="st">'none'</span>, mode<span class="op">=</span><span class="st">'lines'</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create node traces</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>node_x <span class="op">=</span> []</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>node_y <span class="op">=</span> []</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> []</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> node <span class="kw">in</span> G.nodes():</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> pos[node]</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    node_x.append(x)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    node_y.append(y)</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    text.append(node)</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>node_trace <span class="op">=</span> go.Scatter(x<span class="op">=</span>node_x, y<span class="op">=</span>node_y, text<span class="op">=</span>text, mode<span class="op">=</span><span class="st">'markers+text'</span>, hoverinfo<span class="op">=</span><span class="st">'text'</span>, marker<span class="op">=</span><span class="bu">dict</span>(showscale<span class="op">=</span><span class="va">True</span>, colorscale<span class="op">=</span><span class="st">'YlGnBu'</span>, size<span class="op">=</span><span class="dv">10</span>))</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the figure layout to make it taller and possibly wider</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[edge_trace, node_trace],</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>                layout<span class="op">=</span>go.Layout(showlegend<span class="op">=</span><span class="va">False</span>, hovermode<span class="op">=</span><span class="st">'closest'</span>,</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>                                 margin<span class="op">=</span><span class="bu">dict</span>(b<span class="op">=</span><span class="dv">0</span>,l<span class="op">=</span><span class="dv">0</span>,r<span class="op">=</span><span class="dv">0</span>,t<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>                                 xaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">False</span>, zeroline<span class="op">=</span><span class="va">False</span>, showticklabels<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>                                 yaxis<span class="op">=</span><span class="bu">dict</span>(showgrid<span class="op">=</span><span class="va">False</span>, zeroline<span class="op">=</span><span class="va">False</span>, showticklabels<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>                                 height<span class="op">=</span><span class="dv">800</span>,  <span class="co"># Increase height for a taller plot</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>                                 width<span class="op">=</span><span class="dv">1400</span>))  <span class="co"># Optional: Adjust width as needed</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the plot</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>AQUI SERIA IMPORTANTE METER la info de las reglas más representativas</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming 'data' is your DataFrame and 'CodSA' is the column you're working with</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>distinct_values <span class="op">=</span> data[<span class="st">'CodSA'</span>].unique()</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the NumPy array to a DataFrame</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>distinct_values_df <span class="op">=</span> pd.DataFrame(distinct_values, columns<span class="op">=</span>[<span class="st">'CodSA'</span>])</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the file path and name for the Excel file</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> parent_dir <span class="op">+</span> <span class="st">'/data/distinctValues.xlsx'</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the DataFrame to Excel</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>distinct_values_df.to_excel(file_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">#distinct_values.to_excel(file_path, index=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="análisis-de-series-temporales" class="level2">
<h2 class="anchored" data-anchor-id="análisis-de-series-temporales">Análisis de series temporales</h2>
<section id="paso-1-preparación-de-los-datos-para-análisis-de-serie-temporal" class="level3">
<h3 class="anchored" data-anchor-id="paso-1-preparación-de-los-datos-para-análisis-de-serie-temporal">Paso 1: Preparación de los Datos para Análisis de Serie Temporal</h3>
<p>En el primer paso de nuestro análisis de serie temporal, nos enfocamos en preparar los datos para su posterior exploración y modelado. Este proceso implica agrupar los datos según fechas específicas y sumar los valores asociados para cada grupo. El objetivo es obtener una visión clara de cómo se comporta la variable de interés (‘Valor CIF US$’) a lo largo del tiempo.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>grouped_data <span class="op">=</span> data.groupby(<span class="st">'Fecha DUA'</span>)[<span class="st">'Valor CIF US$'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>grouped_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Fecha DUA</th>
<th data-quarto-table-cell-role="th">Valor CIF US$</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2021-01-04</td>
<td>7226.16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2021-01-05</td>
<td>16784.84</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2021-01-06</td>
<td>12538.98</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2021-01-07</td>
<td>6144.09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2021-01-08</td>
<td>6306.10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="paso-2-preparación-de-datos-para-modelado-con-prophet" class="level3">
<h3 class="anchored" data-anchor-id="paso-2-preparación-de-datos-para-modelado-con-prophet">Paso 2: Preparación de Datos para Modelado con Prophet</h3>
<p>Después de agrupar y sumar los datos en el paso anterior, el siguiente paso en nuestro análisis de serie temporal es preparar los datos específicamente para el modelado con la biblioteca Prophet de Facebook. Prophet espera que los nombres de las columnas de la serie temporal sean ‘ds’ para la fecha y ‘y’ para la variable que queremos predecir.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_prophet <span class="op">=</span> grouped_data[[<span class="st">'Fecha DUA'</span>, <span class="st">'Valor CIF US$'</span>]].rename(columns<span class="op">=</span>{<span class="st">'Fecha DUA'</span>: <span class="st">'ds'</span>, <span class="st">'Valor CIF US$'</span>: <span class="st">'y'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> Prophet()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>m.fit(df_prophet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>15:23:34 - cmdstanpy - INFO - Chain [1] start processing
15:23:34 - cmdstanpy - INFO - Chain [1] done processing</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>&lt;prophet.forecaster.Prophet at 0x309423df0&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>future <span class="op">=</span> m.make_future_dataframe(periods<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>future.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">689</td>
<td>2024-03-23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">690</td>
<td>2024-03-24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">691</td>
<td>2024-03-25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">692</td>
<td>2024-03-26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">693</td>
<td>2024-03-27</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> m.predict(future)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>forecast[[<span class="st">'ds'</span>, <span class="st">'yhat'</span>, <span class="st">'yhat_lower'</span>, <span class="st">'yhat_upper'</span>]].tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">yhat</th>
<th data-quarto-table-cell-role="th">yhat_lower</th>
<th data-quarto-table-cell-role="th">yhat_upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">689</td>
<td>2024-03-23</td>
<td>5407.617537</td>
<td>-5313.451042</td>
<td>15707.603099</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">690</td>
<td>2024-03-24</td>
<td>11026.972798</td>
<td>-293.772460</td>
<td>22735.389843</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">691</td>
<td>2024-03-25</td>
<td>23013.417602</td>
<td>12257.718077</td>
<td>33546.807690</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">692</td>
<td>2024-03-26</td>
<td>13025.203032</td>
<td>3004.216884</td>
<td>24146.789499</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">693</td>
<td>2024-03-27</td>
<td>13382.376099</td>
<td>3366.023433</td>
<td>24355.850292</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fig1 <span class="op">=</span> m.plot(forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="crisp-dm-couriers_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig2 <span class="op">=</span> m.plot_components(forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="crisp-dm-couriers_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophet.plot <span class="im">import</span> plot_plotly, plot_components_plotly</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>plot_plotly(m, forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plot_components_plotly(m, forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/jorgebarquero/anaconda3/envs/Enae_SeriesTemporales/lib/python3.8/site-packages/plotly/basedatatypes.py:2314: DeprecationWarning:

The append_trace method is deprecated and will be removed in a future version.
Please use the add_trace method with the row and col parameters.


/Users/jorgebarquero/anaconda3/envs/Enae_SeriesTemporales/lib/python3.8/site-packages/plotly/basedatatypes.py:2314: DeprecationWarning:

The append_trace method is deprecated and will be removed in a future version.
Please use the add_trace method with the row and col parameters.


/Users/jorgebarquero/anaconda3/envs/Enae_SeriesTemporales/lib/python3.8/site-packages/plotly/basedatatypes.py:2314: DeprecationWarning:

The append_trace method is deprecated and will be removed in a future version.
Please use the add_trace method with the row and col parameters.


/Users/jorgebarquero/anaconda3/envs/Enae_SeriesTemporales/lib/python3.8/site-packages/plotly/basedatatypes.py:2314: DeprecationWarning:

The append_trace method is deprecated and will be removed in a future version.
Please use the add_trace method with the row and col parameters.


/Users/jorgebarquero/anaconda3/envs/Enae_SeriesTemporales/lib/python3.8/site-packages/plotly/basedatatypes.py:2314: DeprecationWarning:

The append_trace method is deprecated and will be removed in a future version.
Please use the add_trace method with the row and col parameters.

</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TRATANDO de probar el modelo</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(df_prophet[<span class="st">'ds'</span>], df_prophet[<span class="st">'y'</span>], test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the Prophet model</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> Prophet()</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>m.fit(pd.DataFrame({<span class="st">'ds'</span>: X_train, <span class="st">'y'</span>: y_train}))</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions for the testing data</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>future <span class="op">=</span> pd.DataFrame({<span class="st">'ds'</span>: X_test})</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>forecast <span class="op">=</span> m.predict(future)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate evaluation metrics</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> mean_squared_error(y_test, forecast[<span class="st">'yhat'</span>])</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(y_test <span class="op">-</span> forecast[<span class="st">'yhat'</span>]))</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Root Mean Squared Error (RMSE):"</span>, rmse)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mean Absolute Error (MAE):"</span>, mae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>15:23:36 - cmdstanpy - INFO - Chain [1] start processing
15:23:37 - cmdstanpy - INFO - Chain [1] done processing</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error (RMSE): 10316.148479455887
Mean Absolute Error (MAE): 8535.956197192043</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="evaluación" class="level1">
<h1>4. Evaluación</h1>
</section>
<section id="deployment" class="level1">
<h1>5. Deployment</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>